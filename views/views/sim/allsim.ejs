<!-- Wappler include head-page="layouts/main" jquery_slim_33="cdn" fontawesome_4="cdn" is="dmx-app" id="allsim" appConnect="local" bootstrap5="local" components="{dmxBootstrap5TableGenerator:{},dmxBrowser:{},dmxBootstrap5Modal:{},dmxTyped:{},dmxStateManagement:{},dmxDataTraversal:{},dmxBootstrap5PagingGenerator:{},dmxBootstrap5Navigation:{},dmxNotifications:{},dmxPreloader:{},dmxScheduler:{}}" -->
<div class="modal" id="newSim" is="dmx-bs5-modal" tabindex="-1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="container-fluid" dmx-show="loading.value==false">

          <div class="row">
            <div class="col">
              <form method="post" is="dmx-api-form" id="postNewSim" action="http://localhost:5243/api/simMobile" post-data="json" dmx-on:success="notifies1.success('Nouvelle sim enregistrée');scheduler1.start();newSim.toggle()" dmx-on:error="notifies1.danger('Cette sim existe deja');scheduler1.start();loading.setValue(false)" dmx-on:start="loading.setValue(true)" dmx-header:authorization="connectedUser.data.token">
                <div class="row justify-content-center">
                  <div class="col-12 col-md-8 col-lg-7 col-md-5 text-center">
                    <div class="fdb-box fdb-touch">
                      <div class="row">
                        <div class="col">
                          <h1>Enregistrement sim</h1>
                        </div>
                      </div>
                      <div class="row mt-4">
                        <div class="col">
                          <input id="connectedUserData" name="UserCrea" type="hidden" class="form-control" dmx-bind:value="connectedUser.data.matricule " />
                          <input id="DateCrea" name="DateCrea" type="hidden" class="form-control" dmx-bind:value="DateCreaValue.datetime" />
                          <div class="form-group mb-3">
                            <label for="input1" class="form-label" id="numsimlabel">Numero de la nouvelle sim</label>
                            <input id="NumTel" name="NumTel" class="form-control" type="number" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">
                          <div class="form-group mb-3">
                            <label for="selectModel" class="form-label" id="pinsimlabel">Code Pin</label>
                            <input id="Pin" name="Pin" class="form-control" type="number" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">
                          <div class="form-group mb-3">
                            <label for="selectEquipe" class="form-label" id="puklabel">Code Puk</label>
                            <input id="Puk" name="Puk" class="form-control" type="number" />
                          </div>
                        </div>
                      </div>
                      <div class="row mt-4">
                        <div class="col">
                          <div class="d-flex justify-content-around">
                            <button id="submit" class="btn btn-primary" type="submit" dmx-bind:disabled="!Pin.value||! NumTel.value||!Puk.value" dmx-on:click="loading.setValue(true)">
                              Enregistrer
                            </button>

                            <button id="cancel" class="btn btn-warning" data-bs-dismiss="modal">
                              Annuler
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<dmx-data-view id="data_view1" dmx-bind:data="selectedSim.value.logAffectationList" dmx-bind:pagesize="10"></dmx-data-view>
<dmx-data-view id="allSimView" dmx-bind:data="sims.data" dmx-bind:page="sims.paging.pages" dmx-bind:pagesize="10"></dmx-data-view>
<meta name="ac:route" content="/views/sim/allsim" />
<dmx-local-manager id="connectedUser"></dmx-local-manager>
<dmx-value id="loading" dmx-bind:value="false"></dmx-value>
<dmx-preloader id="preloader1" spinner="doubleBounce" color="#FF011B" bgcolor="#FFEAEA" size="100" preview="true" dmx-show="loading.value==true"></dmx-preloader>
<dmx-scheduler id="scheduler1" delay="3" noload="true" norepeat="true"></dmx-scheduler>
<dmx-notifications id="notifies1"></dmx-notifications>

<dmx-datetime id="DateCreaValue"></dmx-datetime>
<div is="dmx-browser" id="browser1"></div>
<dmx-value id="loadingData" dmx-bind:value="true"></dmx-value>
<dmx-value id="selectedSim"></dmx-value>
<dmx-api-datasource id="sims" is="dmx-fetch" url="http://localhost:5243/api/simMobile/loadEdit" dmx-on:unauthorized="browser1.goto('/auth/login',true)" dmx-header:authorization="connectedUser.data.token" dmx-on:done="loadingData.setValue(false)"></dmx-api-datasource>
<div class="wappler-block container-fluid">
  <div class="row">
    <div class="col-12 col-md-7 bg-white">
      <div class="d-flex justify-content-between">
        <h4 class="fw-bolder text-center shadow-sm lh-base fst-italic mark mb-0" style="text-decoration: underline">
          Liste de toutes les cartes sims
        </h4><button id="btn11" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newSim">
          Ajouter <i class="fa fa-plus"></i>
        </button>
      </div><button id="btn1" class="btn" dmx-show="loadingData.value">
        <span class="spinner-border spinner-border-sm" role="status"></span>chargement...
      </button>
      <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover table-sm">
          <thead>
            <tr>
              <th>#</th>
              <th>Numero</th>
              <th>Pin</th>
              <th>Puk</th>
              <th>Actuellement affecté</th>
              <th>Appareil</th>
              <th>Agent</th>
              <th>Affecté par</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="allSimView.data" id="tableRepeat1">
            <tr dmx-on:click="selectedSim.setValue($value)" dmx-class:bg-info="affectation!=null">
              <td dmx-text="IdSim"></td>
              <td dmx-text="NumTel"></td>
              <td dmx-text="Pin"></td>
              <td dmx-text="Puk"></td>
              <td dmx-text="affectation!==null?'Oui':'Non'"></td>
              <td dmx-text="affectation.NomTsp"></td>
              <td dmx-text="affectation.NomEmploye"></td>
              <td dmx-text="affectation.affectedBy"></td>
              <td dmx-text="affectation.DateCreation"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <ul class="pagination" dmx-dataview="allSimView" dmx-generator="bs5paging">
        <li class="page-item" dmx-class:disabled="allSimView.page == 1" aria-label="First">
          <a href="javascript:void(0)" class="page-link" dmx-on:click="allSimView.first()"><span aria-hidden="true">&lsaquo;&lsaquo;</span></a>
        </li>
        <li class="page-item" dmx-class:disabled="allSimView.page == 1" aria-label="Previous">
          <a href="javascript:void(0)" class="page-link" dmx-on:click="allSimView.prev()"><span aria-hidden="true">&lsaquo;</span></a>
        </li>
        <li class="page-item" dmx-class:active="title == allSimView.page" dmx-class:disabled="!active" dmx-repeat="allSimView.getDataViewPagination(2,1,'...')">
          <a href="javascript:void(0)" class="page-link" dmx-on:click="allSimView.select(page)">{{title)}}</a>
        </li>
        <li class="page-item" dmx-class:disabled="allSimView.page == allSimView.pages" aria-label="Next">
          <a href="javascript:void(0)" class="page-link" dmx-on:click="allSimView.next()"><span aria-hidden="true">&rsaquo;</span></a>
        </li>
        <li class="page-item" dmx-class:disabled="allSimView.page == allSimView.pages" aria-label="Last">
          <a href="javascript:void(0)" class="page-link" dmx-on:click="allSimView.last()"><span aria-hidden="true">&rsaquo;&rsaquo;</span></a>
        </li>
      </ul>
    </div>
    <div class="col-12 col-md-5">
      <div class="row">
        <div class="col">
          <h4 class="fw-bolder text-center shadow-sm lh-base fst-italic mark mb-0" style="text-decoration: underline">
            Historique d'affectation de la carte sim
          </h4>
          <div class="table-responsive">
            <div class="table-responsive">
              <table class="table table-striped table-bordered table-hover table-sm">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Appareil</th>
                    <th>Agent</th>
                    <th>Affecté par</th>
                  </tr>
                </thead>
                <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="data_view1.data" id="tableRepeat3">
                  <tr>
                    <td dmx-text="DateCrea"></td>
                    <td dmx-text="TspName"></td>
                    <td dmx-text="EmployeName"></td>
                    <td dmx-text="affectedBy"></td>
                  </tr>
                </tbody>
              </table>
              <ul class="pagination" dmx-dataview="data_view1" dmx-generator="bs5paging">
                <li class="page-item" dmx-class:disabled="data_view1.page == 1" aria-label="First">
                  <a href="javascript:void(0)" class="page-link" dmx-on:click="data_view1.first()"><span aria-hidden="true">&lsaquo;&lsaquo;</span></a>
                </li>
                <li class="page-item" dmx-class:disabled="data_view1.page == 1" aria-label="Previous">
                  <a href="javascript:void(0)" class="page-link" dmx-on:click="data_view1.prev()"><span aria-hidden="true">&lsaquo;</span></a>
                </li>
                <li class="page-item" dmx-class:active="title == data_view1.page" dmx-class:disabled="!active" dmx-repeat="data_view1.getDataViewPagination(2,1,'...')">
                  <a href="javascript:void(0)" class="page-link" dmx-on:click="data_view1.select(page)">{{title)}}</a>
                </li>
                <li class="page-item" dmx-class:disabled="data_view1.page == data_view1.pages" aria-label="Next">
                  <a href="javascript:void(0)" class="page-link" dmx-on:click="data_view1.next()"><span aria-hidden="true">&rsaquo;</span></a>
                </li>
                <li class="page-item" dmx-class:disabled="data_view1.page == data_view1.pages" aria-label="Last">
                  <a href="javascript:void(0)" class="page-link" dmx-on:click="data_view1.last()"><span aria-hidden="true">&rsaquo;&rsaquo;</span></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<meta name="ac:route" content="/views/sim/allsim" />